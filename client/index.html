<!-- <div id="startScreen">
	Username: <input id="usernameInput" type="text"></input><br>
	<button id="playButton">Play</button>
</div>

<div id="gameDiv" style="display:none;">
	<div id="game" style="position: absolute; width: 500px; height: 500px;">
		<canvas id="ctx" width="500" height="500"
			style="position: absolute; border: 1px solid #000000; z-index: 1;"></canvas>
		<canvas id="ctx-ui" width="500" height="500"
			style="position: absolute; border: 1px solid #000000; z-index: 2;"></canvas>
	</div>

	<div id="belowGame" style="position: absolute; top: 520px;">
		<div id="chat-text" style="width: 500px; height: 100px; overflow-y: scroll;">
			<div>Hello!</div>
		</div>
		<form id="chat-form">
			<input id="chat-input" type="text" style="width: 500px;"></input>
		</form>
	</div>
</div> -->

<body style="margin: 0px; padding: 0px;">
	<div id="startScreen">
		Username: <input id="usernameInput" type="text"></input><br>
		<button id="playButton">Play</button>
	</div>

	<div id="gameDiv" style="display:none; height: 100vh; width: 100vw;">
		<div id="game" style="position: absolute; height: 100vh; width: 100vw;">
			<canvas id="ctx" style="position: absolute; border: 1px solid #000000; z-index: 1;"></canvas>
			<canvas id="ctx-ui" style="position: absolute; border: 1px solid #000000; z-index: 2;"></canvas>
		</div>

		<!-- <div id="belowGame" style="position: absolute; top: 520px;">
			<div id="chat-text" style="width: 500px; height: 100px; overflow-y: scroll;">
				<div>Hello!</div>
			</div>
			<form id="chat-form">
				<input id="chat-input" type="text" style="width: 500px;"></input>
			</form>
		</div> -->
	</div>
</body>

<!-- Dont forget to remove the server import -->
<script src="/socket.io/socket.io.js"></script>
<script>
	// var chatText = document.getElementById('chat-text');
	// var chatInput = document.getElementById('chat-input');
	// var chatForm = document.getElementById('chat-form');
	var ctx = document.getElementById("ctx").getContext("2d");
	var ctxUi = document.getElementById("ctx-ui").getContext("2d");
	var canvas = document.getElementById("ctx");
	var canvasUI = document.getElementById("ctx-ui");

	var playButton = document.getElementById('playButton');
	var usernameInput = document.getElementById('usernameInput');
	var startScreen = document.getElementById('startScreen');


	var WIDTH = 500;
	var HEIGHT = 500;
	var socket = io();
	const FPS = 60;

	// removed the collision js stuff from here
	var array = [745, 746, 747, 1610613483, 1610613515, 1610613547, 1610613579, 1610613483, 1610613515, 1610613547,
		1610613579, 1610613483, 1610613515, 1610613547, 1610613579, 1610613483, 1610613515, 1610613547, 1610613579,
		1610613483, 1610613515, 1610613547, 1610613579, 1610613483, 1610613515, 1610613547, 1610613579, 1610613483,
		1610613515, 1610613547, 1610613579, 1610613483, 1610613515, 1610613547, 1610613579, 1610613483, 1610613515,
		1610613547, 1610613579, 1610613483, 1610613515, 1610613547, 1610613579, 1610613483, 1610613515, 1610613547,
		1610613579, 1610613483, 1610613515, 1610613547,
		777, 778, 779, 1610613482, 1610613514, 1610613546, 1610613578, 1610613482, 1610613514, 1610613546, 1610613578,
		1610613482, 1610613514, 1610613546, 1610613578, 1610613482, 1610613514, 1610613546, 1610613578, 1610613482,
		1610613514, 1610613546, 1610613578, 1610613482, 1610613514, 1610613546, 1610613578, 1610613482, 1610613514,
		1610613546, 1610613578, 1610613482, 1610613514, 1610613546, 1610613578, 1610613482, 1610613514, 1610613546,
		1610613578, 1610613482, 1610613514, 1610613546, 1610613578, 1610613482, 1610613514, 1610613546, 1610613578,
		1610613482, 1610613514, 1610613546,
		809, 810, 811, 1610613481, 1610613513, 1610613545, 1610613577, 1610613481, 1610613513, 1610613545, 1610613577,
		1610613481, 1610613513, 1610613545, 1610613577, 1610613481, 1610613513, 1610613545, 1610613577, 1610613481,
		1610613513, 1610613545, 1610613577, 1610613481, 1610613513, 1610613545, 1610613577, 1610613481, 1610613513,
		1610613545, 1610613577, 1610613481, 1610613513, 1610613545, 1610613577, 1610613481, 1610613513, 1610613545,
		1610613577, 1610613481, 1610613513, 1610613545, 1610613577, 1610613481, 1610613513, 1610613545, 1610613577,
		1610613481, 1610613513, 1610613545,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613513,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613513, 1610613546,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779,
		1610613515, 1610613547,
		809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811,
		1610613514, 1610613546,
		841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843,
		1610613513, 1610613545,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 777, 778, 779, 777, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 809, 810, 811, 809, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 841, 842, 843, 841, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 777, 778, 779, 777, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		809, 810, 811, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779, 777, 778, 779,
		1610613514, 1610613546,
		841, 842, 843, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811, 809, 810, 811,
		1610613513, 1610613545,
		745, 746, 747, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843, 841, 842, 843,
		1610613515, 1610613547,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		745, 746, 747, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		777, 778, 779, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613481, 1610613513, 1610613545,
		809, 810, 811, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613483, 1610613515, 1610613547,
		841, 842, 843, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1610613482, 1610613514, 1610613546,
		777, 778, 779, 2684355401, 2684355369, 2684355337, 2684355305, 2684355401, 2684355369, 2684355337, 2684355305,
		2684355401, 2684355369, 2684355337, 2684355305, 2684355401, 2684355369, 2684355337, 2684355401, 2684355369,
		2684355337, 2684355305, 2684355401, 2684355369, 2684355337, 2684355305, 2684355401, 2684355369, 2684355337,
		2684355305, 2684355401, 2684355369, 2684355337, 2684355305, 2684355401, 2684355369, 2684355337, 2684355305,
		2684355401, 2684355369, 2684355337, 2684355305, 2684355401, 2684355369, 2684355337, 2684355305, 2684355401,
		2684355369, 2684355337, 2684355305,
		809, 810, 811, 2684355402, 2684355370, 2684355338, 2684355306, 2684355402, 2684355370, 2684355338, 2684355306,
		2684355402, 2684355370, 2684355338, 2684355306, 2684355402, 2684355370, 2684355338, 2684355402, 2684355370,
		2684355338, 2684355306, 2684355402, 2684355370, 2684355338, 2684355306, 2684355402, 2684355370, 2684355338,
		2684355306, 2684355402, 2684355370, 2684355338, 2684355306, 2684355402, 2684355370, 2684355338, 2684355306,
		2684355402, 2684355370, 2684355338, 2684355306, 2684355402, 2684355370, 2684355338, 2684355306, 2684355402,
		2684355370, 2684355338, 2684355306,
		841, 842, 843, 2684355403, 2684355371, 2684355339, 2684355307, 2684355403, 2684355371, 2684355339, 2684355307,
		2684355403, 2684355371, 2684355339, 2684355307, 2684355403, 2684355371, 2684355339, 2684355403, 2684355371,
		2684355339, 2684355307, 2684355403, 2684355371, 2684355339, 2684355307, 2684355403, 2684355371, 2684355339,
		2684355307, 2684355403, 2684355371, 2684355339, 2684355307, 2684355403, 2684355371, 2684355339, 2684355307,
		2684355403, 2684355371, 2684355339, 2684355307, 2684355403, 2684355371, 2684355339, 2684355307, 2684355403,
		2684355371, 2684355339, 2684355307,
	];

	var array2D = [];
	for (var i = 0; i < 50; i++) {
		array2D[i] = [];
		for (var j = 0; j < 50; j++) {
			array2D[i][j] = array[i * 50 + j];
		}
	}
	//

	let resizeCanvas = function () {
		WIDTH = window.innerWidth - 4;
		HEIGHT = window.innerHeight - 4;
		canvas.width = WIDTH;
		canvas.height = HEIGHT;
		canvasUI.width = WIDTH;
		canvasUI.height = HEIGHT;
		ctx.font = '30px Arial';
		ctxUi.font = '20px Arial';
		ctx.mozImageSmoothingEnabled = false; //better graphics for pixel art
		ctx.msImageSmoothingEnabled = false;
		ctx.imageSmoothingEnabled = false;
	}
	resizeCanvas();

	window.addEventListener('resize', function () {
		resizeCanvas();
	});

	playButton.onclick = function () {
		socket.emit('start', usernameInput.value);
	}

	// socket.on('addToChat', function (data) {
	// 	chatText.innerHTML += '<div>' + data + '</div>';
	// });
	socket.on('evalAnswer', function (data) {
		console.log(data);
	});

	socket.on('startResponse', function () {
		startScreen.style.display = 'none';
		gameDiv.style.display = 'inline-block';
	});


	// chatForm.onsubmit = function (e) {
	// 	e.preventDefault();
	// 	if (chatInput.value[0] === '/')
	// 		socket.emit('evalServer', chatInput.value.slice(1));
	// 	else
	// 		socket.emit('sendMsgToServer', chatInput.value);
	// 	chatInput.value = '';
	// }

	//game
	var Img = {};
	Img.player = new Image();
	Img.player.src = '/client/img/player.png';
	Img.otherPlayer = new Image();
	Img.otherPlayer.src = '/client/img/bat.png';
	Img.bullet = new Image();
	Img.bullet.src = '/client/img/bullet.png';

	Img.map = {};
	Img.map['field'] = new Image();
	Img.map['field'].src = '/client/img/brownMap.png';

	var Player = function (initPack) {
		var self = {};
		self.id = initPack.id;
		self.number = initPack.number;
		self.x = initPack.x;
		self.y = initPack.y;
		self.hp = initPack.hp;
		self.hpMax = initPack.hpMax;
		self.score = initPack.score;
		self.username = initPack.username;

		self.draw = function () {
			var x = self.x - Player.list[selfId].x + WIDTH / 2;
			var y = self.y - Player.list[selfId].y + HEIGHT / 2;

			var hpWidth = 40 * self.hp / self.hpMax;
			ctx.fillStyle = 'green';
			ctx.fillRect(x - hpWidth / 2, y - 40, hpWidth, 4);

			if (Player.list[self.id].username === 'char') {
				var width = Img.otherPlayer.width * 2;
				var height = Img.otherPlayer.height * 2;


				ctx.drawImage(Img.otherPlayer,
					0, 0, Img.otherPlayer.width, Img.otherPlayer.height,
					x - width / 2, y - height / 2, width, height);
			} else {
				var width = Img.player.width * 2;
				var height = Img.player.height * 2;


				ctx.drawImage(Img.player,
					0, 0, Img.player.width, Img.player.height,
					x - width / 2, y - height / 2, width, height);
			}

			ctx.fillStyle = 'white';
			var textWidth = ctx.measureText(self.username).width;
			ctx.fillText(self.username, x - textWidth / 2, y + 50);
		}

		Player.list[self.id] = self;


		return self;
	}
	Player.list = {};


	var Bullet = function (initPack) {
		var self = {};
		self.id = initPack.id;
		self.x = initPack.x;
		self.y = initPack.y;

		self.draw = function () {
			var width = Img.bullet.width / 2;
			var height = Img.bullet.height / 2;

			var x = self.x - Player.list[selfId].x + WIDTH / 2;
			var y = self.y - Player.list[selfId].y + HEIGHT / 2;

			ctx.drawImage(Img.bullet,
				0, 0, Img.bullet.width, Img.bullet.height,
				x - width / 2, y - height / 2, width, height);
		}

		Bullet.list[self.id] = self;
		return self;
	}
	Bullet.list = {};

	var selfId = null;

	socket.on('init', function (data) {
		if (data.selfId)
			selfId = data.selfId;
		//{ player : [{id:123,number:'1',x:0,y:0},{id:1,number:'2',x:0,y:0}], bullet: []}
		for (var i = 0; i < data.player.length; i++) {
			new Player(data.player[i]);
		}
		for (var i = 0; i < data.bullet.length; i++) {
			new Bullet(data.bullet[i]);
		}
	});

	socket.on('update', function (data) {
		//{ player : [{id:123,x:0,y:0},{id:1,x:0,y:0}], bullet: []}
		for (var i = 0; i < data.player.length; i++) {
			var pack = data.player[i];
			var p = Player.list[pack.id];
			if (p) {
				if (pack.x !== undefined)
					p.x = pack.x;
				if (pack.y !== undefined)
					p.y = pack.y;
				if (pack.hp !== undefined)
					p.hp = pack.hp;
				if (pack.score !== undefined)
					p.score = pack.score;
				if (pack.username !== undefined)
					p.username = pack.username;
			}
		}
		for (var i = 0; i < data.bullet.length; i++) {
			var pack = data.bullet[i];
			var b = Bullet.list[data.bullet[i].id];
			if (b) {
				if (pack.x !== undefined)
					b.x = pack.x;
				if (pack.y !== undefined)
					b.y = pack.y;
			}
		}
	});

	socket.on('remove', function (data) {
		//{player:[12323],bullet:[12323,123123]}
		for (var i = 0; i < data.player.length; i++) {
			delete Player.list[data.player[i]];
		}
		for (var i = 0; i < data.bullet.length; i++) {
			delete Bullet.list[data.bullet[i]];
		}
	});

	setInterval(function () {
		if (!selfId)
			return;
		ctx.clearRect(0, 0, WIDTH, HEIGHT);
		drawMap();
		drawCollisionMap();
		drawScore();
		for (var i in Player.list)
			Player.list[i].draw();
		for (var i in Bullet.list)
			Bullet.list[i].draw();
	}, FPS);

	var drawMap = function () {
		var player = Player.list[selfId];
		var x = WIDTH / 2 - player.x;
		var y = HEIGHT / 2 - player.y;
		// ctx.drawImage(Img.map['field'], x, y);

		// ctx.drawImage(Img.map['field'], 0, 0, Img.map['field'].width, Img.map['field'].height, x, y,
		// 	Img.map['field'].width,
		// 	Img.map['field'].height,
		// );

		ctx.drawImage(Img.map['field'], 0, 0, Img.map['field'].width, Img.map['field'].height, x, y,
			50 * 32,
			50 * 32,
		);
	}

	function drawCollisionMap() {
		// Assuming array2D is accessible in this scope
		for (var y = 0; y < 50; y++) {
			for (var x = 0; x < 50; x++) {
				// Check if the tile is a collision tile
				if (array2D[y][x] != 0) {
					var screenX = x * 32 - Player.list[selfId].x + WIDTH / 2;
					var screenY = y * 32 - Player.list[selfId].y + HEIGHT / 2;

					// Draw a red square
					ctx.fillStyle = 'rgba(255, 0, 0, 0.5)'; // Semi-transparent red
					ctx.fillRect(screenX, screenY, 32, 32);
				}
			}
		}
	}


	var drawScore = function () {
		if (lastScore === Player.list[selfId].score)
			return;
		lastScore = Player.list[selfId].score;
		ctxUi.clearRect(0, 0, 500, 500);
		ctxUi.fillStyle = 'black';
		ctxUi.fillText(Player.list[selfId].score, 0, 30);
	}
	var lastScore = null;

	document.onkeydown = function (event) {
		if (event.keyCode === 68) //d
			socket.emit('keyPress', {
				inputId: 'right',
				state: true
			});
		else if (event.keyCode === 83) //s
			socket.emit('keyPress', {
				inputId: 'down',
				state: true
			});
		else if (event.keyCode === 65) //a
			socket.emit('keyPress', {
				inputId: 'left',
				state: true
			});
		else if (event.keyCode === 87) // w
			socket.emit('keyPress', {
				inputId: 'up',
				state: true
			});
	}
	document.onkeyup = function (event) {
		if (event.keyCode === 68) //d
			socket.emit('keyPress', {
				inputId: 'right',
				state: false
			});
		else if (event.keyCode === 83) //s
			socket.emit('keyPress', {
				inputId: 'down',
				state: false
			});
		else if (event.keyCode === 65) //a
			socket.emit('keyPress', {
				inputId: 'left',
				state: false
			});
		else if (event.keyCode === 87) // w
			socket.emit('keyPress', {
				inputId: 'up',
				state: false
			});
	}

	document.onmousedown = function (event) {
		socket.emit('keyPress', {
			inputId: 'attack',
			state: true
		});

	}
	document.onmouseup = function (event) {
		socket.emit('keyPress', {
			inputId: 'attack',
			state: false
		});
	}
	document.onmousemove = function (event) {
		var player = Player.list[selfId];
		if (!player) return;

		var mouseX = event.clientX - ctx.canvas.getBoundingClientRect().left;
		var mouseY = event.clientY - ctx.canvas.getBoundingClientRect().top;

		var dx = mouseX - (player.x - Player.list[selfId].x + WIDTH / 2);
		var dy = mouseY - (player.y - Player.list[selfId].y + HEIGHT / 2);

		var angle = Math.atan2(dy, dx) / Math.PI * 180;
		socket.emit('keyPress', {
			inputId: 'mouseAngle',
			state: angle
		});
	}

	// document.oncontextmenu = function (event) {
	// 		event.preventDefault();
	// 	}
</script>